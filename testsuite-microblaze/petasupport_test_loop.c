/** \file
 * $Id$
 *
 * \brief Test case for a strange double floating point program.
 *
 * Copyright (c) 2010 Xiphos Technologies, Inc.
 * All rights reserved.
 *
 * $Author$
 * $Date$
 * $Revision$
 */




#include <stdio.h>
#include <stdlib.h>
#include <math.h>

#if 0
long int _rnd = 0xbeefedde;
long int random(void)
{
	_rnd ^= (_rnd >> 3) | (_rnd << 20);
	return _rnd;
}


static double g_dTableCData[880] = {-1.4901161193847656E-008, -1.4901161193847656E-008,
        -1.4901161193847656E-008, -1.4901161193847656E-008,
        -1.4901161193847656E-008, -1.4901161193847656E-008,
        -1.4901161193847656E-008, -1.4901161193847656E-008,
        -1.4901161193847656E-008, -1.4901161193847656E-008,
        -1.4901161193847656E-008, -1.4901161193847656E-008,
        -1.4901161193847656E-008, -1.4901161193847656E-008,
        -1.4901161193847656E-008, -1.4901161193847656E-008,
        -1.4901161193847656E-008, -1.4901161193847656E-008,
        -1.4901161193847656E-008, -1.4901161193847656E-008,
        -1.4901161193847656E-008, -1.4901161193847656E-008,
        -1.4901161193847656E-008, -1.4901161193847656E-008,
        -1.4901161193847656E-008, -1.4901161193847656E-008,
        -1.4901161193847656E-008, -1.4901161193847656E-008,
        -1.4901161193847656E-008, -1.4901161193847656E-008,
        -1.4901161193847656E-008, -1.4901161193847656E-008,
        -1.4901161193847656E-008, -1.4901161193847656E-008,
        -1.4901161193847656E-008, -1.4901161193847656E-008,
        -1.4901161193847656E-008, -1.4901161193847656E-008,
        -1.4901161193847656E-008, -1.4901161193847656E-008,
        -1.4901161193847656E-008, -1.4901161193847656E-008,
        -1.4901161193847656E-008, -1.4901161193847656E-008,
        -1.4901161193847656E-008, -1.4901161193847656E-008,
        -1.4901161193847656E-008, -1.4901161193847656E-008,
        -1.4901161193847656E-008, -1.4901161193847656E-008,
        -1.4901161193847656E-008, -1.4901161193847656E-008,
        -1.4901161193847656E-008, -1.4901161193847656E-008,
        -1.4901161193847656E-008, -1.4901161193847656E-008,
        -1.4901161193847656E-008, -1.4901161193847656E-008,
        -1.4901161193847656E-008, -1.4901161193847656E-008,
        -1.4901161193847656E-008, -1.4901161193847656E-008,
        -1.4901161193847656E-008, -1.4901161193847656E-008,
        -1.4901161193847656E-008, -1.4901161193847656E-008,
        -1.4901161193847656E-008, -1.4901161193847656E-008,
        -1.4901161193847656E-008, -1.4901161193847656E-008,
        -1.4901161193847656E-008, -1.4901161193847656E-008,
        -1.4901161193847656E-008, -1.4901161193847656E-008,
        -1.4901161193847656E-008, -1.4901161193847656E-008,
        -1.4901161193847656E-008, -1.4901161193847656E-008,
        -1.4901161193847656E-008, -1.4901161193847656E-008,
        -1.4901161193847656E-008, -1.4901161193847656E-008,
        -1.4901161193847656E-008, -1.4901161193847656E-008,
        -1.4901161193847656E-008, -1.4901161193847656E-008,
        -1.4901161193847656E-008, -1.4901161193847656E-008, 0.0, 0.0, 0.0, 0.0,
        0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
        0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
        -1.4901161193847656E-008, -1.4901161193847656E-008,
        -1.4901161193847656E-008, -1.4901161193847656E-008,
        -1.4901161193847656E-008, -1.4901161193847656E-008,
        -1.4901161193847656E-008, -1.4901161193847656E-008,
        -1.4901161193847656E-008, -1.4901161193847656E-008,
        -1.4901161193847656E-008, -1.4901161193847656E-008,
        -1.4901161193847656E-008, -1.4901161193847656E-008,
        -1.4901161193847656E-008, -1.4901161193847656E-008,
        -1.4901161193847656E-008, -1.4901161193847656E-008,
        -1.4901161193847656E-008, -1.4901161193847656E-008,
        -1.4901161193847656E-008, -1.4901161193847656E-008,
        -1.4901161193847656E-008, 0.0, 0.0, 1.0, 1.0, 0.0, 0.0, 0.0, 1.0, 0.0,
        0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, -1.0, -1.0, -1.0,
        -1.0, -1.0, -1.0, -7103.4715694963234, 160.36972191281086,
        110.44869058095746, 0.13956865378280922, 1.0786806646205469,
        7.4100855484677393, 0.19999998509883882, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
        0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 1.0, 1.0, 1.0, 0.0, 0.0, 0.0,
        0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
        0.0, 0.0, 0.0, 0.0, 0.0, 0.0, -1.4901161193847656E-008,
        -1.4901161193847656E-008, -1.4901161193847656E-008,
        -1.4901161193847656E-008, -1.4901161193847656E-008,
        -1.4901161193847656E-008, -1.4901161193847656E-008,
        -1.4901161193847656E-008, -1.4901161193847656E-008,
        -1.4901161193847656E-008, -1.4901161193847656E-008,
        -1.4901161193847656E-008, -1.4901161193847656E-008,
        -1.4901161193847656E-008, -1.4901161193847656E-008, -630201599.75000215,
        0.0, 0.0, 1.0, 1.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0,
        0.0, 1.0, 0.0, 0.0, 0.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0,
        -7103.4715694963234, 160.36972191281086, 110.44869058095746,
        0.13956865378280922, 1.0786806646205469, 7.4100855484677393,
        -630201599.5500021, 0.0, 0.0, 0.0, 0.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0,
        1.0, 1.0, 1.0, 0.0, 1.0, 1.0, 1.0, 0.0, 406.83760683760681,
        223.1990231990232, 222.71062271062269, 407.08180708180709,
        222.95482295482296, 223.44322344322345, 222.95482295482296,
        222.95482295482296, 1.9975579975579977E-005, 3.9560439560439565E-006,
        7.4725274725274726E-006, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
        0.0, 0.0, 0.0, 0.0, 0.0, -1.4901161193847656E-008,
        -1.4901161193847656E-008, -1.4901161193847656E-008,
        -1.4901161193847656E-008, -1.4901161193847656E-008,
        -1.4901161193847656E-008, -1.4901161193847656E-008,
        -1.4901161193847656E-008, -1.4901161193847656E-008,
        -1.4901161193847656E-008, -1.4901161193847656E-008,
        -1.4901161193847656E-008, -630201599.55, 0.0, 0.0, 1.0, 1.0, 0.0, 0.0,
        0.0, 1.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, -1.0,
        -1.0, -1.0, -1.0, -1.0, -1.0, -7103.4715694963234, 160.36972191281086,
        110.44869058095746, 0.13956865378280922, 1.0786806646205469,
        7.4100855484677393, -630201599.35, 0.0, 0.0, 0.0, 0.0, 1.0, 1.0, 1.0,
        1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 0.0, 1.0, 1.0, 1.0, 0.0,
        407.08180708180709, 223.1990231990232, 223.1990231990232,
        406.83760683760681, 223.1990231990232, 223.68742368742369,
        223.1990231990232, 222.2222222222222, 2.0317460317460319E-005,
        3.8583638583638584E-006, 7.6190476190476205E-006, 0.0, 0.0, 0.0, 0.0,
        0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
        -1.4901161193847656E-008, -1.4901161193847656E-008,
        -1.4901161193847656E-008, -1.4901161193847656E-008,
        -1.4901161193847656E-008, -1.4901161193847656E-008,
        -1.4901161193847656E-008, -1.4901161193847656E-008,
        -1.4901161193847656E-008, -1.4901161193847656E-008,
        -1.4901161193847656E-008, -1.4901161193847656E-008, -630201599.35, 0.0,
        0.0, 1.0, 1.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0,
        1.0, 0.0, 0.0, 0.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0,
        -7103.4715694963234, 160.36972191281086, 110.44869058095746,
        0.13956865378280922, 1.0786806646205469, 7.4100855484677393,
        -630201599.15, 0.0, 0.0, 0.0, 0.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0,
        1.0, 1.0, 0.0, 1.0, 1.0, 1.0, 0.0, 406.10500610500611,
        223.44322344322345, 222.2222222222222, 407.08180708180709,
        222.46642246642244, 222.2222222222222, 222.71062271062269,
        222.71062271062269, 1.9975579975579977E-005, 3.8583638583638584E-006,
        7.5213675213675216E-006, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
        0.0, 0.0, 0.0, 0.0, 0.0, -1.4901161193847656E-008,
        -1.4901161193847656E-008, -1.4901161193847656E-008,
        -1.4901161193847656E-008, -1.4901161193847656E-008,
        -1.4901161193847656E-008, -1.4901161193847656E-008,
        -1.4901161193847656E-008, -1.4901161193847656E-008,
        -1.4901161193847656E-008, -1.4901161193847656E-008,
        -1.4901161193847656E-008, -630201599.15, 0.0, 0.0, 1.0, 1.0, 0.0, 0.0,
        0.0, 1.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, -1.0,
        -1.0, -1.0, -1.0, -1.0, -1.0, -7103.4715694963234, 160.36972191281086,
        110.44869058095746, 0.13956865378280922, 1.0786806646205469,
        7.4100855484677393, -630201598.95, 0.0, 0.0, 0.0, 0.0, 1.0, 1.0, 1.0,
        1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 0.0, 1.0, 1.0, 1.0, 0.0,
        406.34920634920633, 223.1990231990232, 222.46642246642244,
        406.83760683760681, 222.71062271062269, 223.93162393162393,
        223.68742368742369, 222.46642246642244, 2.0268620268620269E-005,
        3.8583638583638584E-006, 7.5213675213675216E-006, 0.0, 0.0, 0.0, 0.0,
        0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0,
        1.0, 0.0, 0.0, 0.0, 1.0, 1.0, 0.0, 0.0, -630201598.95, 0.0, 0.0, 1.0,
        1.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 1.0, 0.0,
        0.0, 0.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -7103.4715694963234,
        160.36972191281086, 110.44869058095746, 0.13956865378280922,
        1.0786806646205469, 7.4100855484677393, -630201598.75, 0.0, 0.0, 0.0,
        0.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 0.0, 1.0, 1.0, 1.0,
        0.0, 406.10500610500611, 223.1990231990232, 222.95482295482296,
        406.5934065934066, 222.46642246642244, 222.71062271062269,
        223.1990231990232, 221.97802197802196, 2.0073260073260076E-005,
        4.0537240537240545E-006, 7.5213675213675216E-006, 0.0, 0.0, 0.0, 0.0,
        0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0,
        1.0, 0.0, 0.0, 0.0, 1.0, 1.0, 0.0, 0.0, 220449616.25, 0.0, 0.0, 1.0,
        1.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 1.0, 0.0,
        0.0, 0.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -7103.4715694963234,
        160.36972191281086, 110.44869058095746, 0.13956865378280922,
        1.0786806646205469, 7.4100855484677393, 220449616.45, 0.0, 0.0, 0.0,
        0.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 0.0, 1.0, 1.0, 1.0,
        0.0, 406.83760683760681, 223.1990231990232, 223.1990231990232,
        407.3260073260073, 223.1990231990232, 222.95482295482296,
        222.95482295482296, 221.97802197802196, 2.0170940170940173E-005,
        4.0048840048840046E-006, 7.4725274725274726E-006, 0.0, 0.0, 0.0, 0.0,
        0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0,
        1.0, 0.0, 0.0, 0.0, 1.0, 1.0, 0.0, 0.0, 220449616.45, 0.0, 0.0, 1.0,
        1.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 1.0, 0.0,
        0.0, 0.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -7103.4715694963234,
        160.36972191281086, 110.44869058095746, 0.13956865378280922,
        1.0786806646205469, 7.4100855484677393, 220449616.65, 0.0, 0.0, 0.0,
        -1.4901161193847656E-008, -1.4901161193847656E-008,
        -1.4901161193847656E-008, -1.4901161193847656E-008,
        -1.4901161193847656E-008, -1.4901161193847656E-008,
        -1.4901161193847656E-008, -1.4901161193847656E-008,
        -1.4901161193847656E-008, -1.4901161193847656E-008,
        -1.4901161193847656E-008, -1.4901161193847656E-008,
        -1.4901161193847656E-008, -1.4901161193847656E-008,
        -1.4901161193847656E-008, -1.4901161193847656E-008,
        -1.4901161193847656E-008, -1.4901161193847656E-008,
        -1.4901161193847656E-008, -1.4901161193847656E-008,
        -1.4901161193847656E-008, -1.4901161193847656E-008,
        -1.4901161193847656E-008, -1.4901161193847656E-008,
        -1.4901161193847656E-008, -1.4901161193847656E-008,
        -1.4901161193847656E-008, -1.4901161193847656E-008,
        -1.4901161193847656E-008, -1.4901161193847656E-008,
        -1.4901161193847656E-008, -1.4901161193847656E-008,
        -1.4901161193847656E-008, -1.4901161193847656E-008,
        -1.4901161193847656E-008, -1.4901161193847656E-008,
        -1.4901161193847656E-008, -1.4901161193847656E-008,
        -1.4901161193847656E-008, -1.4901161193847656E-008,
        -1.4901161193847656E-008, -1.4901161193847656E-008,
        -1.4901161193847656E-008, -1.4901161193847656E-008,
        -1.4901161193847656E-008, -1.4901161193847656E-008,
        -1.4901161193847656E-008, -1.4901161193847656E-008,
        -1.4901161193847656E-008, -1.4901161193847656E-008,
        -1.4901161193847656E-008, -1.4901161193847656E-008,
        -1.4901161193847656E-008, -1.4901161193847656E-008,
        -1.4901161193847656E-008, -1.4901161193847656E-008,
        -1.4901161193847656E-008, -1.4901161193847656E-008,
        -1.4901161193847656E-008, -1.4901161193847656E-008,
        -1.4901161193847656E-008, -1.4901161193847656E-008,
        -1.4901161193847656E-008, -1.4901161193847656E-008,
        -1.4901161193847656E-008, -1.4901161193847656E-008,
        -1.4901161193847656E-008, -1.4901161193847656E-008,
        -1.4901161193847656E-008, -1.4901161193847656E-008,
        -1.4901161193847656E-008, -1.4901161193847656E-008,
        -1.4901161193847656E-008, -1.4901161193847656E-008,
        -1.4901161193847656E-008, -1.4901161193847656E-008,
        -1.4901161193847656E-008, -1.4901161193847656E-008,
        -1.4901161193847656E-008, -1.4901161193847656E-008,
        -1.4901161193847656E-008, -1.4901161193847656E-008,
        -1.4901161193847656E-008, -1.4901161193847656E-008,
        -1.4901161193847656E-008, -1.4901161193847656E-008,
        -1.4901161193847656E-008, -1.4901161193847656E-008};

  static double g_dTableA[10] = {0.0, 0.2, 0.4, 0.6, 0.8, 1.0, 1.2, 1.4, 1.6, 1.8};
  static double g_dTableB[88];
  static double g_dTableC[10][88];
  static double g_dTableD[88];

int petasupport_test_loop_local(int iArgc, char * ppcArgv[]) {

  double m_dTableA[10] = {0.0, 0.2, 0.4, 0.6, 0.8, 1.0, 1.2, 1.4, 1.6, 1.8};
  double m_dTableB[88];
  double m_dTableC[10][88];
  double m_dTableD[88];
  double dA,dB;

  int i,j,k;
  int iTestCount;
  int iTestTotalIterations=1001;

  printf("%s\n", __func__);
  for (i=0;i<10;i++) {
    for (j=0;j<88;j++) {
      g_dTableC[i][j] = g_dTableCData[i*88+j];
      m_dTableC[i][j] = g_dTableCData[i*88+j];
    }
  }
  for (i=0;i<88;i++) {
    g_dTableD[i] = 200.0*(double)random()/(double)RAND_MAX;
    m_dTableD[i] = 200.0*(double)random()/(double)RAND_MAX;
  }

  for (iTestCount=0;iTestCount<iTestTotalIterations;iTestCount++) {
    for (i=1; i<=88; i++) {
      dB = m_dTableD[i];
      dB = fmod(dB,m_dTableA[9]);
      j = (int) ((dB - m_dTableA[0])/(m_dTableA[1]-m_dTableA[0]));
      j++;
      if (j>9) {
        j=9;
      }
      k = j + 1;
      dA = (dB - m_dTableA[-1+j]) / (m_dTableA[-1+k] - m_dTableA[-1+j]);
      m_dTableB[-1+i] = (1.0 - dA) * m_dTableC[-1+j][-1+i] + 
          dA * m_dTableC[-1+k][-1+i];
    }
  }
  for (i = 1; i <= 88; i++) {
     g_dTableB[i - 1] += m_dTableB[i - 1];
  } 
  return(0);

}


int petasupport_test_loop_global(int iArgc, char * ppcArgv[]) {

  double m_dTableA[10] = {0.0, 0.2, 0.4, 0.6, 0.8, 1.0, 1.2, 1.4, 1.6, 1.8};
  double m_dTableB[88];
  double m_dTableC[10][88];
  double m_dTableD[88];
  double dA,dB;

  int i,j,k;
  int iTestCount;
  int iTestTotalIterations=1001;

  printf("%s\n", __func__);
  for (i=0;i<10;i++) {
    for (j=0;j<88;j++) {
      g_dTableC[i][j] = g_dTableCData[i*88+j];
      m_dTableC[i][j] = g_dTableCData[i*88+j];
    }
  }
  for (i=0;i<88;i++) {
    g_dTableD[i] = 200.0*(double)random()/(double)RAND_MAX;
    m_dTableD[i] = 200.0*(double)random()/(double)RAND_MAX;
  }

  for (iTestCount=0;iTestCount<iTestTotalIterations;iTestCount++) {
    for (i=1; i<=88; i++) {
      dB = g_dTableD[i];
      dB = fmod(dB,g_dTableA[9]);
      j = (int) ((dB - g_dTableA[0])/(g_dTableA[1]-g_dTableA[0]));
      j++;
      if (j>9) {
        j=9;
      }
      k = j + 1;
      dA = (dB - g_dTableA[-1+j]) / (g_dTableA[-1+k] - g_dTableA[-1+j]);
      g_dTableB[-1+i] = (1.0 - dA) * g_dTableC[-1+j][-1+i] + 
        dA * g_dTableC[-1+k][-1+i];
    }
  }
  return(0);
}

#endif
